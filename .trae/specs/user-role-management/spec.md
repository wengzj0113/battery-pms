# 用户管理与角色权限系统规格说明

## Why
当前系统虽然已有用户数据和JWT认证，但缺乏完整的用户管理功能和基于角色的权限控制。非管理员用户应无法访问敏感数据（如合同金额总计）和管理功能（用户管理）。

## What Changes
- 新增用户管理模块（管理员可查看、添加、编辑、删除用户）
- 实现基于角色的权限控制
- 管理员（管理员角色）可查看所有项目数据，包括合同金额统计
- 非管理员用户隐藏/禁用敏感功能和数据：
  - 隐藏左侧菜单中的"用户管理"入口
  - 隐藏Dashboard中的"合同金额总计"统计
  - 隐藏项目列表和详情页中的"合同金额"列
- 限制项目数据的访问范围（按角色过滤）

## Impact
- 影响现有用户认证流程
- 需要修改前端Dashboard、项目列表、项目详情等页面
- 需要新增用户管理API端点
- 需要修改后端数据过滤逻辑

## ADDED Requirements

### Requirement: 用户管理功能
系统应提供完整的用户管理功能，仅管理员可访问。

#### Scenario: 管理员查看用户列表
- **GIVEN** 用户以"管理员"角色登录
- **WHEN** 访问用户管理页面
- **THEN** 显示所有用户列表（用户名、真实姓名、角色、创建时间）

#### Scenario: 管理员添加新用户
- **GIVEN** 用户以"管理员"角色登录
- **WHEN** 填写新用户信息并提交
- **THEN** 系统创建新用户并返回成功消息

#### Scenario: 管理员编辑用户
- **GIVEN** 用户以"管理员"角色登录
- **WHEN** 选择用户并修改其信息
- **THEN** 系统更新用户信息并返回成功消息

#### Scenario: 管理员删除用户
- **GIVEN** 用户以"管理员"角色登录
- **WHEN** 选择用户并确认删除
- **THEN** 系统删除用户并返回成功消息

### Requirement: 角色权限控制
系统应根据用户角色控制功能可见性和数据访问。

#### Scenario: 非管理员隐藏用户管理入口
- **GIVEN** 用户以非管理员角色登录
- **THEN** 左侧导航栏不显示"用户管理"菜单项

#### Scenario: 非管理员隐藏敏感数据
- **GIVEN** 用户以非管理员角色登录
- **THEN** Dashboard不显示"项目总额"统计卡片
- **THEN** 项目列表不显示"合同金额"列
- **THEN** 项目详情不显示"合同金额"字段

### Requirement: 项目数据权限过滤
非管理员用户只能查看与自己角色相关的项目。

#### Scenario: 技术角色查看项目
- **GIVEN** 用户以"技术"角色登录
- **WHEN** 查看项目列表
- **THEN** 仅显示技术负责人为自己的项目

#### Scenario: 采购角色查看项目
- **GIVEN** 用户以"采购"角色登录
- **WHEN** 查看项目列表
- **THEN** 仅显示采购负责人为自己的项目

## MODIFIED Requirements

### Requirement: 登录接口
登录接口保持不变，但需确保返回用户角色信息。

### Requirement: 仪表盘统计
- **管理员**：显示所有项目的统计数据，包括"项目总额"
- **其他角色**：仅显示自己负责的项目的统计数据

### Requirement: 项目列表API
- **管理员**：返回所有项目
- **其他角色**：根据用户角色过滤，返回该用户负责的项目

## REMOVED Requirements

### Requirement: 原有公开访问
**Reason**: 系统中所有功能都需要登录后访问
**Migration**: 所有API都需要认证

